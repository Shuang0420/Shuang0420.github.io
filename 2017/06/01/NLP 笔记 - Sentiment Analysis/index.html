<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />













  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="NLP,sentiment analysis,情感分析," />





  <link rel="alternate" href="/atom.xml" title="徐阿衡" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.3" />






<meta name="description" content="Stanford Dan Jurafsky &amp;amp; Chris Manning: Natural Language Processing 课程笔记。">
<meta property="og:type" content="article">
<meta property="og:title" content="NLP 笔记 - Sentiment Analysis">
<meta property="og:url" content="http://www.shuang0420.cn/2017/06/01/NLP 笔记 - Sentiment Analysis/index.html">
<meta property="og:site_name" content="徐阿衡">
<meta property="og:description" content="Stanford Dan Jurafsky &amp;amp; Chris Manning: Natural Language Processing 课程笔记。">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/product%20sentiment.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/Twitter%20sentiment%20app.jpg">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/Emoticons.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/boolean%20multinomial%20naive%20bayes.jpg">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/Order%20effects.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/disagreement%20between%20polarity.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/STEP2.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/STEP3.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/STEP4.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/phrase1.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/Polarity%20phrase.png">
<meta property="og:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/sentiment%20for%20aspects.png">
<meta property="og:updated_time" content="2020-09-10T12:26:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NLP 笔记 - Sentiment Analysis">
<meta name="twitter:description" content="Stanford Dan Jurafsky &amp;amp; Chris Manning: Natural Language Processing 课程笔记。">
<meta name="twitter:image" content="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/product%20sentiment.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '6294135991397516000',
      author: '阿衡'
    }
  };
</script>

<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6146435155426457",
    enable_page_level_ads: true
  });
</script>




  <link rel="canonical" href="http://www.shuang0420.cn/2017/06/01/NLP 笔记 - Sentiment Analysis/"/>


  <title> NLP 笔记 - Sentiment Analysis | 徐阿衡 </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="en">

  










  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">徐阿衡</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Shuang</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-works">
          <a href="/works" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Works
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/aboutme" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input" placeholder="search my blog...">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
         
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                NLP 笔记 - Sentiment Analysis
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-06-01T09:02:27+08:00" content="2017-06-01">
              2017-06-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index">
                    <span itemprop="name">NLP</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/NLP/CMU-11611/" itemprop="url" rel="index">
                    <span itemprop="name">CMU 11611</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/01/NLP 笔记 - Sentiment Analysis/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/06/01/NLP 笔记 - Sentiment Analysis/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Stanford Dan Jurafsky &amp; Chris Manning: Natural Language Processing 课程笔记。<br><a id="more"></a></p>
<p><strong>Sentiment Analysis</strong> 有许多别称，如 Opinion extraction/Opinion mining/Sentiment mining/Subjectivity analysis，都是同一个意思，不过隐含着不同的应用场景。大致来说，情感分析有以下的应用:</p>
<p><strong>Products:</strong> 产品评价，不仅仅是简单的好评差评，情感分析还能分析人们对具体产品的具体属性的具体评价，如下图，对 product review 抽取 aspects/attributes，判断 sentiment，最后 aggregate 得出结果<br><img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/product%20sentiment.png" class="ful-image" alt="product%20sentiment.png"><br><strong>Public sentiment:</strong> 公众意见(public opinion)，比如说分析消费者信息指数，股票指数等。之前就有人做过用 CALM 来预测道琼斯指数(Bollen et al. 2011 Twitter mood predicts the stock market)，算法也应用到了工业场景<br><strong>Politics:</strong> 公共政策，看公众对候选人/政治议题的看法<br><strong>Prediction:</strong> 预测选举结果，预测市场趋势等等。</p>
<p>一个成熟的产品<a href="https://www.csc2.ncsu.edu/faculty/healey/tweet_viz/tweet_app/" target="_blank" rel="external">Twitter Sentiment App</a>，能够通过 Twitter 数据来分析人们对某个品牌/话题的情感<br><img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/Twitter%20sentiment%20app.jpg" class="ful-image" alt="Twitter%20sentiment%20app.jpg"></p>
<blockquote>
<p><strong>Attitudes</strong>: “enduring, affectively colored beliefs, dispositions towards objects or persons”</p>
</blockquote>
<p>Sentiment analysis 说白了就是来分析人们对一个事物的<strong>态度(attitudes)</strong>，包含下面几个元素(以 Mary likes the movie 为例)</p>
<ul>
<li>Holder (source) of attitude<br>持有态度的人: Mary</li>
<li>Target (aspect) of attitude<br>对象: the movie</li>
<li>Type of attitude<br>态度类型: like<br><strong>From a set of types:</strong> Like, love, hate, value, desire, etc.<br><strong>Or (more commonly) simple weighted polarity:</strong> positive, negative, neutral, together with strength</li>
<li>Text containing the attitude<br>文本: Mary likes the movie<br>Sentence or entire document</li>
</ul>
<p>最简单的情感分析任务，或者说在情感分析方向的 baseline model，是分析/预测电影评论是 positive 还是 negative 的。</p>
<h1 id="Baseline-Algorithm"><a href="#Baseline-Algorithm" class="headerlink" title="Baseline Algorithm"></a>Baseline Algorithm</h1><p>常用到的语料库 <a href="hXp://www.cs.cornell.edu/people/pabo/movie-­‐review-­‐data" target="_blank" rel="external">IMDB Polarity Data 2.0</a>，<br><strong>目的：</strong> polarity detection: is this review positive or negative?<br><strong>步骤：</strong></p>
<ol>
<li>Tokenization</li>
<li>Feature Extraction</li>
<li>Classification using different classifiers<ul>
<li>Naive Bayes</li>
<li>MaxEnt</li>
<li>SVM</li>
</ul>
</li>
</ol>
<h2 id="Sentiment-Tokenization"><a href="#Sentiment-Tokenization" class="headerlink" title="Sentiment Tokenization"></a>Sentiment Tokenization</h2><p>除了正常 tokenization 要注意的问题如处理 HTML/XML markup 外，情感分析还可能需要处理</p>
<ul>
<li><strong>twitter markup</strong>(hashtag 等)</li>
<li><strong>Capitalization:</strong> 大小写通常会保留，大写字母往往反映强烈的情感</li>
<li><strong>Emotions</strong>(表情符号)</li>
</ul>
<img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/Emoticons.png" class="ful-image" alt="Emoticons.png">
<p>有用的 Tokenizer 代码</p>
<ul>
<li><a href="https://github.com/dlatk/happierfuntokenizing" target="_blank" rel="external">Christopher Potts sentiment tokenizer</a></li>
<li><a href="https://github.com/brendano/tweetmotif" target="_blank" rel="external">Brendan O’Connor twitter tokenizer</a></li>
</ul>
<h2 id="Extracting-Features"><a href="#Extracting-Features" class="headerlink" title="Extracting Features"></a>Extracting Features</h2><p>关于特征提取，两个重要的问题，一是怎么来<strong>处理否定词(negation)</strong>，二是<strong>选什么词作为特征</strong>。</p>
<h3 id="Negation"><a href="#Negation" class="headerlink" title="Negation"></a>Negation</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I didn&apos;t like this movie</div><div class="line">I really like this movie</div></pre></td></tr></table></figure>
<p>如果对否定词不做处理，那么上面两条评论的结果都是 positive，这显然不对。一种有效的处理否定词的方案是<strong>对否定词后、下一个标点符号前的每个词都加上 NOT_ 的前缀来作为标识</strong>，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">didn&apos;t like this movie, but I</div><div class="line">=&gt;</div><div class="line">didn&apos;t NOT_like NOT_this NOT_movie but I</div></pre></td></tr></table></figure></p>
<p>具体见<br>Das, Sanjiv and Mike Chen. 2001. Yahoo! for Amazon: Extracting market sentiment from stock message boards. In Proceedings of the Asia Paciﬁc Finance Association Annual Conference (APFA).<br>Bo Pang, Lillian Lee, and Shivakumar Vaithyanathan. 2002. Thumbs up? Sentiment Classification using Machine Learning Techniques. EMNLP-2002, 79—86.</p>
<h3 id="Words-to-use"><a href="#Words-to-use" class="headerlink" title="Words to use"></a>Words to use</h3><p>一般两种方案，一是仅仅<strong>使用形容词(adjectives)</strong>，而是使用<strong>所有的单词(all words)</strong>，通常而言，使用所有的词的效果会更好些，因为动词(verbs)、名词(nouns)会提供更多有用的信息。</p>
<h2 id="Classifier"><a href="#Classifier" class="headerlink" title="Classifier"></a>Classifier</h2><p>作为 Baseline model，这里会使用 Naive Bayes，没啥悬念，计算如下</p>
<p>$$c_{NB}=argmax_{c_j \in C} P(c_j) \prod_{i \in positions} P(w_i | c_j)$$</p>
<ul>
<li><strong>Prior:</strong> how likely we see a positive movie review</li>
<li><strong>Likelihood Function:</strong> for every review, how likely every word is expressed by a positive movie review</li>
</ul>
<p>采用 <strong>Laplace/Add-one Smoothing</strong></p>
<p>$$\hat P(w|c)={count(w,c)+1 \over count(c)+|V|}$$</p>
<p>一个变种或者改进版是<strong>Binarized(Boolean feature) Multinomial Naive Bayes</strong>，它基于这样一个直觉，对情感分析而言，单词是否出现(word occurrence)这个特征比单词出现了几次(word frequency)更为重要，举个例子，出现一次 fantastic 提供了 positive 的信息，而出现 5 次 fantastic 并没有给我们提供更多信息。boolean multinomial Naive Bayes 就是把所有大于 1 的 word counts 压缩为 1。</p>
<p>算法<br><img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/boolean%20multinomial%20naive%20bayes.jpg" class="ful-image" alt="boolean%20multinomial%20naive%20bayes.jpg"></p>
<p>也有研究认为取中间值 log(freq(w)) 效果更好一些，相关论文如下：<br>B. Pang, L. Lee, and S. Vaithyanathan. 2002. Thumbs up? Sen+ment Classiﬁcation using Machine Learning Techniques. EMNLP-­‐2002, 79—86.<br>V. Metsis, I. Androutsopoulos, G. Paliouras. 2006. Spam Filtering with Naive Bayes – Which Naive Bayes? CEAS 2006 -­‐ Third Conference on Email and Anti‐Spam.<br>K.-­‐M. Schneider. 2004. On word frequency informa+on and negative evidence in Naive Bayes text classiﬁca+on. ICANLP, 474-­‐485.<br>JD Rennie, L Shih, J Teevan. 2003. Tackling the poor assumptions of naive bayes text classiﬁers. ICML 2003</p>
<p><em>当然在实践中，MaxEnt 和 SVM 的效果要比 Naive Bayes 好的多</em></p>
<h2 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h2><p>有些句子里并<strong>不包含情感词(sentiment word)</strong>，如下面一句是 negative 的态度，然而并不能通过情感词来得出</p>
<p>“If you are reading this because it is your darling fragrance, please wear it at home exclusively, and tape the windows shut.”</p>
<p>还有一个问题是<strong>排序问题(Order effect)</strong>，尽管前面堆砌了很多情感词，但最后来个全盘否定，显然 Naive Bayes 没法处理这种问题<br><img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/Order%20effects.png" class="ful-image" alt="Order%20effects.png"></p>
<h1 id="Sentiment-Lexicons"><a href="#Sentiment-Lexicons" class="headerlink" title="Sentiment Lexicons"></a>Sentiment Lexicons</h1><p>看一下目前已经有的 Lexicons，</p>
<ul>
<li><a href="http://www.wjh.harvard.edu/~inquirer" target="_blank" rel="external">The General Inquirer</a><ul>
<li><a href="http://www.wjh.harvard.edu/~inquirer/homecat.htm" target="_blank" rel="external">List of Categories</a></li>
<li><a href="http://www.wjh.harvard.edu/~inquirer/inquirerbasic.xls" target="_blank" rel="external">Spreadsheet</a></li>
</ul>
</li>
<li><a href="http://www.liwc.net/" target="_blank" rel="external">LIWC(Linguistic Inquiry and Word Count)</a></li>
<li><a href="http://www.cs.pitt.edu/mpqa/subj_lexicon.html" target="_blank" rel="external">MPQA Subjectivity Cues Lexicon</a></li>
<li><a href="http://www.cs.uic.edu/~liub/FBS/opinion-­‐lexicon-­‐English.rar" target="_blank" rel="external">Bing Liu Opinion Lexicon</a></li>
<li><a href="http://sentiwordnet.isti.cnr.it/" target="_blank" rel="external">SentiWordNet</a></li>
</ul>
<p>看下各个词库的 disagreements between polarity lexicons<br><img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/disagreement%20between%20polarity.png" class="ful-image" alt="disagreement%20between%20polarity.png"></p>
<p>那么怎么来分析 IMDB 里每个单词的 polarity 呢？<br><strong>How likely is each word to appear in each sentiment class?</strong><br><strong>likelihood:</strong> $$P(w|c)={f(w,c) \over \sum_{w \in c} f(w,c)}$$<br><strong>Make them comparable between words - Scaled likelihood:</strong><br>$${P(w|c)\over P(w)}$$</p>
<p>更多见 Potts, Christopher. 2011. On the negativity of negation. SALT 20, 636-­‐659.</p>
<h1 id="Learning-Sentiment-Lexicons"><a href="#Learning-Sentiment-Lexicons" class="headerlink" title="Learning Sentiment Lexicons"></a>Learning Sentiment Lexicons</h1><p>除了目前已有的 lexicon，我们还可以根据自己的语料库来训练自己的 sentiment lexicon。</p>
<h2 id="Semi-supervised-learning-of-lexicons"><a href="#Semi-supervised-learning-of-lexicons" class="headerlink" title="Semi-supervised learning of lexicons"></a>Semi-supervised learning of lexicons</h2><p>基于<strong>少量的有标注的数据+人工建立的规则</strong>，采用 <strong>bootstrap</strong> 方法来学习 lexicon</p>
<h3 id="Hatzivassiloglou-and-McKeown-intuition-for-identifying-word-polarity"><a href="#Hatzivassiloglou-and-McKeown-intuition-for-identifying-word-polarity" class="headerlink" title="Hatzivassiloglou and McKeown intuition for identifying word polarity"></a>Hatzivassiloglou and McKeown intuition for identifying word polarity</h3><p><strong>论文:</strong> Vasileios Hatzivassiloglou and Kathleen R. McKeown. 1997. Predicting the Semantic Orientation of Adjectives. ACL, 174–181</p>
<p>基于这样的<strong>假设</strong>:</p>
<ul>
<li>用 AND 连起来的形容词有着相同的 polarity<br>fair <strong>and</strong> legitimate, corrupt <strong>and</strong> brutal</li>
<li>用 BUT 连起来的形容词则相反<br>fair <strong>but</strong> brutal</li>
</ul>
<p><strong>论文方法：</strong></p>
<ol>
<li>对 1336 个形容词形成的种子集合进行标注，657 个 positive，679 个 negative</li>
<li>通过 google 搜索来查询 conjoined 形容词，eg. “was nice and”<img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/STEP2.png" class="ful-image" alt="STEP2.png"></li>
<li>Supervised classifier 通过 count(AND), count(BUT) 来给每个词对(word pair)计算 polarity similarity<img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/STEP3.png" class="ful-image" alt="STEP3.png"></li>
<li>将 graph 分区<img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/STEP4.png" class="ful-image" alt="STEP4.png">
</li>
</ol>
<p>这种方法难以处理短语</p>
<h3 id="Turnev-Algorithm"><a href="#Turnev-Algorithm" class="headerlink" title="Turnev Algorithm"></a>Turnev Algorithm</h3><p><strong>论文:</strong> Turney (2002):Thumbs Up or Thumbs Down? Semantic Orientation Applied to Unsupervised Classification of Reviews</p>
<p><strong>步骤:</strong></p>
<ol>
<li>从评论中抽取形容词短语(two-word phrase)<img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/phrase1.png" class="ful-image" alt="phrase1.png"></li>
<li>学习短语的 polarity<br>如何衡量短语的 polarity 呢？<br>基于下面的假设<ul>
<li>Positive phrases co-‐occur more with <em>“excellent”</em></li>
<li>Negative phrases co-­‐occur more with <em>“poor”</em><br>用 PMI(Pointwise Mutual Information) 来计算 co-occurrence<br><strong>Mutual information</strong> between 2 random variables X and Y<br>$$I(X,Y)=\sum_x \sum_y P(x,y)log_2{P(x,y) \over P(x)P(y)}$$<br><strong>Pointwise mutual information:</strong> how much more do events x and y co-occur than if they were independent<br>$$PMI(X,Y)=log_2{P(x,y) \over P(x)P(y)}$$<br>同样通过搜索引擎(Altavista)查询得到概率<br>P(word) = hits(word)/N<br>$P(word_1,word_2)=hits(word_1 \ NEAR \ word_2)/N^2$<br>$$P(word_1,word_2)=log_2 {hits(word_1 \ NEAR \ word_2) \over hits(word_1)hits(word_2)}$$<img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/Polarity%20phrase.png" class="ful-image" alt="Polarity%20phrase.png"></li>
</ul>
</li>
<li>Rate a review by the average polarity of its phrases</li>
</ol>
<p>一般来说 baseline 的准确率是 59%, Turney algorithm 可以提高到 74%</p>
<h3 id="Using-WordNet-to-learn-polarity"><a href="#Using-WordNet-to-learn-polarity" class="headerlink" title="Using WordNet to learn polarity"></a>Using WordNet to learn polarity</h3><p><strong>论文:</strong><br>S.M. Kim and E. Hovy. 2004. Determining the sentiment of opinions. COLING 2004<br>M. Hu and B. Liu. Mining and summarizing customer reviews. In Proceedings of KDD, 2004</p>
<p><strong>步骤:</strong></p>
<ol>
<li>有一小部分 positive/negative seed-words</li>
<li>从 WordNet 中找到 seed-words 的同义词(synonyms)和反义词(antonyms)<br><strong>Positive Set:</strong> positive words 的同义词 + negative words 的反义词<br><strong>Negative Set:</strong> negative words 的同义词 + positive words 的反义词</li>
<li>重复 2 直到达到终止条件</li>
<li>过滤不合适的词</li>
</ol>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>采用半监督方法来引入 lexicons，好处是:</p>
<ul>
<li>can be domain-specific</li>
<li>can be more robust(for more/new words)</li>
</ul>
<p><strong>Intuition:</strong></p>
<ol>
<li>starts with a seed set of words(good,poor)</li>
<li>find other words that have similar polarity:<br>•  Using “and” and “but”<br>•  Using words that occur nearby in the same document<br>•  Using WordNet synonyms and antonyms</li>
</ol>
<h1 id="Other-Sentiment-Tasks"><a href="#Other-Sentiment-Tasks" class="headerlink" title="Other Sentiment Tasks"></a>Other Sentiment Tasks</h1><h2 id="Finding-aspects-attributes-target"><a href="#Finding-aspects-attributes-target" class="headerlink" title="Finding aspects/attributes/target"></a>Finding aspects/attributes/target</h2><p><strong>论文:</strong><br>M. Hu and B. Liu. 2004. Mining and summarizing customer reviews. In Proceedings of KDD.<br>S. Blair-­‐Goldensohn, K. Hannan, R. McDonald, T. Neylon, G. Reis, and J. Reynar. 2008. Building a Sen+ment Summarizer for Local Service Reviews. WWW Workshop.</p>
<p>很多时候，一条评论并不能简单的被归为 positive/negative，它可能讨论了多个维度，既有肯定又有否定，如下面这个句子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The food was great but the service was awful!</div></pre></td></tr></table></figure></p>
<p>这条评论就是对食物(food)持肯定态度(positive)，对服务(service)持否定态度(negative)，在这种情况下，我们不能简单的对这条评论进行 positive/negative 的分类，而要对其在 food，service 这两个维度上的态度进行分类。<strong>food，service 这些维度，或者说 attributes/aspects/target 从哪里来？</strong> 有两种方法，一种是从文本中抽取常用短语+规则来作为 attributes/aspects，另一种是预先定义好 attributes/aspects</p>
<h3 id="Frequent-phrases-rules"><a href="#Frequent-phrases-rules" class="headerlink" title="Frequent phrases + rules"></a>Frequent phrases + rules</h3><p>首先找到产品评论里的高频短语，然后按规则进行过滤，可用的规则如找紧跟在 sentiment word 后面的短语，”…great fish tacos” 表示 fish tacos 是一个可能的 aspect</p>
<h3 id="Supervised-classification"><a href="#Supervised-classification" class="headerlink" title="Supervised classification"></a>Supervised classification</h3><p>对一些领域如 restaurants/hotels 来说，aspects 比较规范，所以事实上可以人工给一些产品评论标注 aspect(aspects 如 food, décor, service, value, NONE)，然后再给每个句子/短语分类看它属于哪个 aspect</p>
<p>具体步骤:</p>
<ol>
<li>从评论中抽取句子/短语</li>
<li>对句子/短语进行情感分类</li>
<li>得到句子/短语的 aspects</li>
<li>汇总得到 summary<img src="http://images.shuang0420.cn/images/NLP%20%E7%AC%94%E8%AE%B0%20-%20Sentiment%20Analysis/sentiment%20for%20aspects.png" class="ful-image" alt="sentiment%20for%20aspects.png">
</li>
</ol>
<p>值得注意的是，baseline method 的假设是<strong>所有类别出现的概率是相同的</strong>。如果类别不平衡(在现实中往往如此)，我们不能用 accuracy 来评估，而是需要用 F-scores。而类别不平衡的现象越严重，分类器的表现可能就越差。有两个办法来解决这个问题</p>
<ol>
<li>Resampling in training<br>就是说如果 pos 有10^6 条数据，neg 有 10^4 的数据，那么我们都从 10^4 的数据中来划分训练数据</li>
<li>Cost-sensitive learning<br>对较少出现的那个类别的 misclassification 加大惩罚(penalize SVM more for misclassification of the rare thing)</li>
</ol>
<h2 id="How-to-deal-with-7-stars"><a href="#How-to-deal-with-7-stars" class="headerlink" title="How to deal with 7 stars"></a>How to deal with 7 stars</h2><p><strong>论文:</strong> Bo Pang and Lillian Lee. 2005. Seeing stars: Exploiting class relationships for sentiment categorization with respect to rating scales. ACL, 115–124</p>
<p>怎样来处理评分型的评论？</p>
<ol>
<li>Map to binary<br>压缩到 positive/negative。比如说大于 3.5 的作为 negative，其他作为 positive</li>
<li>Use linear or ordinal regression<br>or specialized models like metric labeling</li>
</ol>
<h2 id="Summary-on-Sentiment"><a href="#Summary-on-Sentiment" class="headerlink" title="Summary on Sentiment"></a>Summary on Sentiment</h2><p>通常被建立分类/回归模型来预测 binary/ordinal 类别<br><strong>关于特征提取:</strong></p>
<ul>
<li>negation 很重要</li>
<li>对某些任务，在 Naive bayes 里使用所有的词汇表现更好</li>
<li>对其他任务，可能用部分词汇更好<br>Hand-built polarity lexicons<br>Use seeds and semi-supervised learning to induce lexicons</li>
</ul>
<h1 id="Computational-work-on-other-affective-states"><a href="#Computational-work-on-other-affective-states" class="headerlink" title="Computational work on other affective states"></a>Computational work on other affective states</h1><p>对其他任务也可以用相似手段</p>
<ul>
<li>Emotion:<br>•  Detecting annoyed callers to dialogue system<br>•  Detecting confused/frustrated versus conﬁdent students</li>
<li>Mood:<br>•  Finding traumatized or depressed writers</li>
<li>Interpersonal stances:<br>•  Detection of flirtation or friendliness in conversations</li>
<li>  Personality traits:<br>•  Detection of extroverts</li>
</ul>
<p>E.g., Detection of Friendliness</p>
<p>Friendly speakers use collaborative conversational style<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- Laughter</div><div class="line">- Less use of negative emotional words</div><div class="line">- More sympathy</div><div class="line">​  That’s too bad I’m sorry to hear that!</div><div class="line">- More agreement</div><div class="line">​	 I think so too!</div><div class="line">- Less hedges</div><div class="line">​	 kind of sort of a little …</div></pre></td></tr></table></figure></p>

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat.jpg" alt="徐阿衡 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎关注：徐阿衡的微信公众号</div>
</div>


      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>客官，打个赏呗~</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://7xu83c.com1.z0.glb.clouddn.com/1.pic.jpg" alt="徐阿衡 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/NLP/" rel="tag">#NLP</a>
          
            <a href="/tags/sentiment-analysis/" rel="tag">#sentiment analysis</a>
          
            <a href="/tags/情感分析/" rel="tag">#情感分析</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/24/论文笔记 - Learning to Extract Conditional Knowledge for Question Answering using Dialogue/" rel="next" title="论文笔记 - Learning to Extract Conditional Knowledge for Question Answering using Dialogue">
                <i class="fa fa-chevron-left"></i> 论文笔记 - Learning to Extract Conditional Knowledge for Question Answering using Dialogue
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/05/Alexa 开发新技能 - Lambda/" rel="prev" title="Alexa 开发新技能 - Lambda">
                Alexa 开发新技能 - Lambda <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      



    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
     
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xu83c.com1.z0.glb.clouddn.com/2.pic.jpg"
               alt="徐阿衡" />
          <p class="site-author-name" itemprop="name">徐阿衡</p>
          <p class="site-description motion-element" itemprop="description">读万卷书，行万里路 @SYSU @CMU</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">167</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">126</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Shuang0420" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.linkedin.com/in/shuang-xu-7008b894?trk=nav_responsive_tab_profile_pic" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  LinkedIn
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://zhuanlan.zhihu.com/c_136690664" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://starllap.space" title="Star" target="_blank">Star</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://liam0205.me" title="Liam Huang" target="_blank">Liam Huang</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.libinx.com" title="Li Bin" target="_blank">Li Bin</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Baseline-Algorithm"><span class="nav-number">1.</span> <span class="nav-text">Baseline Algorithm</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Sentiment-Tokenization"><span class="nav-number">1.1.</span> <span class="nav-text">Sentiment Tokenization</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Extracting-Features"><span class="nav-number">1.2.</span> <span class="nav-text">Extracting Features</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Negation"><span class="nav-number">1.2.1.</span> <span class="nav-text">Negation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Words-to-use"><span class="nav-number">1.2.2.</span> <span class="nav-text">Words to use</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Classifier"><span class="nav-number">1.3.</span> <span class="nav-text">Classifier</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Problems"><span class="nav-number">1.4.</span> <span class="nav-text">Problems</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sentiment-Lexicons"><span class="nav-number">2.</span> <span class="nav-text">Sentiment Lexicons</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Learning-Sentiment-Lexicons"><span class="nav-number">3.</span> <span class="nav-text">Learning Sentiment Lexicons</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Semi-supervised-learning-of-lexicons"><span class="nav-number">3.1.</span> <span class="nav-text">Semi-supervised learning of lexicons</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hatzivassiloglou-and-McKeown-intuition-for-identifying-word-polarity"><span class="nav-number">3.1.1.</span> <span class="nav-text">Hatzivassiloglou and McKeown intuition for identifying word polarity</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Turnev-Algorithm"><span class="nav-number">3.1.2.</span> <span class="nav-text">Turnev Algorithm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-WordNet-to-learn-polarity"><span class="nav-number">3.1.3.</span> <span class="nav-text">Using WordNet to learn polarity</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Summary"><span class="nav-number">3.1.4.</span> <span class="nav-text">Summary</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Other-Sentiment-Tasks"><span class="nav-number">4.</span> <span class="nav-text">Other Sentiment Tasks</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Finding-aspects-attributes-target"><span class="nav-number">4.1.</span> <span class="nav-text">Finding aspects/attributes/target</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Frequent-phrases-rules"><span class="nav-number">4.1.1.</span> <span class="nav-text">Frequent phrases + rules</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Supervised-classification"><span class="nav-number">4.1.2.</span> <span class="nav-text">Supervised classification</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-deal-with-7-stars"><span class="nav-number">4.2.</span> <span class="nav-text">How to deal with 7 stars</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Summary-on-Sentiment"><span class="nav-number">4.3.</span> <span class="nav-text">Summary on Sentiment</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Computational-work-on-other-affective-states"><span class="nav-number">5.</span> <span class="nav-text">Computational work on other affective states</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <!-- Other code may be here -->
<div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">徐阿衡</span>
  <a href="http://www.miitbeian.gov.cn/">粤ICP备17129486号</a>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>


<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'httpshuang0420githubio';
      var disqus_identifier = '2017/06/01/NLP 笔记 - Sentiment Analysis/';
      var disqus_title = "NLP 笔记 - Sentiment Analysis";
      var disqus_url = 'http://www.shuang0420.cn/2017/06/01/NLP 笔记 - Sentiment Analysis/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


</body>
</html>
