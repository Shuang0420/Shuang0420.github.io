<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />













  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Crawler," />





  <link rel="alternate" href="/atom.xml" title="徐阿衡" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.3" />






<meta name="description" content="补充前面没有提到的一些技巧。">
<meta property="og:type" content="article">
<meta property="og:title" content="爬虫总结(五)-- 其他技巧">
<meta property="og:url" content="http://www.shuang0420.com/2016/06/20/爬虫总结-五-其他技巧/index.html">
<meta property="og:site_name" content="徐阿衡">
<meta property="og:description" content="补充前面没有提到的一些技巧。">
<meta property="og:image" content="http://7xu83c.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-05%20%E4%B8%8B%E5%8D%884.19.03.png">
<meta property="og:image" content="http://7xu83c.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-04%20%E4%B8%8B%E5%8D%883.37.07.png">
<meta property="og:updated_time" content="2020-05-08T06:43:39.982Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="爬虫总结(五)-- 其他技巧">
<meta name="twitter:description" content="补充前面没有提到的一些技巧。">
<meta name="twitter:image" content="http://7xu83c.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-05%20%E4%B8%8B%E5%8D%884.19.03.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '6294135991397516000',
      author: '阿衡'
    }
  };
</script>

<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6146435155426457",
    enable_page_level_ads: true
  });
</script>




  <link rel="canonical" href="http://www.shuang0420.com/2016/06/20/爬虫总结-五-其他技巧/"/>


  <title> 爬虫总结(五)-- 其他技巧 | 徐阿衡 </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="en">

  










  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">徐阿衡</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Shuang</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-works">
          <a href="/works" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Works
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/aboutme" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input" placeholder="search my blog...">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
         
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                爬虫总结(五)-- 其他技巧
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-06-20T10:45:12+08:00" content="2016-06-20">
              2016-06-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index">
                    <span itemprop="name">NLP</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/NLP/Crawler/" itemprop="url" rel="index">
                    <span itemprop="name">Crawler</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/20/爬虫总结-五-其他技巧/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/20/爬虫总结-五-其他技巧/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>补充前面没有提到的一些技巧。<br><a id="more"></a></p>
<h2 id="模拟登录"><a href="#模拟登录" class="headerlink" title="模拟登录"></a>模拟登录</h2><h3 id="研究源码"><a href="#研究源码" class="headerlink" title="研究源码"></a>研究源码</h3><p>以 github 登录（<a href="https://github.com/login）" target="_blank" rel="external">https://github.com/login）</a> 为例，查看html源码会发现表单里面有个隐藏的authenticity_token值，这个是需要先获取然后跟用户名和密码一起提交的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;auth-form p-3&quot; id=&quot;login&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!-- &lt;/textarea&gt; --&gt;&lt;!-- &apos;&quot;` --&gt;&lt;form accept-charset=&quot;UTF-8&quot; action=&quot;/session&quot; data-form-nonce=&quot;b2e0b5f779ddbb5dbf93b903a82e5fc5204da96b&quot; method=&quot;post&quot;&gt;&lt;div style=&quot;margin:0;padding:0;display:inline&quot;&gt;&lt;input name=&quot;utf8&quot; type=&quot;hidden&quot; value=&quot;&amp;#x2713;&quot; /&gt;&lt;input name=&quot;authenticity_token&quot; type=&quot;hidden&quot; value=&quot;MDOLdxNeNMPn2sjrj51G+v/yMYpikLru8QWiLI170WRME4UBfvGItiAhzZWFujZVUSoT7SFygFcjE8pMfRcMHQ==&quot; /&gt;&lt;/div&gt;      &lt;div class=&quot;auth-form-header&quot;&gt;</div><div class="line">        &lt;h1&gt;Sign in to GitHub&lt;/h1&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line"></div><div class="line"></div><div class="line">      &lt;div id=&quot;js-flash-container&quot;&gt;</div><div class="line">&lt;/div&gt;</div><div class="line"></div><div class="line"></div><div class="line">      &lt;div class=&quot;auth-form-body mt-4&quot;&gt;</div><div class="line"></div><div class="line">        &lt;label for=&quot;login_field&quot;&gt;</div><div class="line">          Username or email address</div><div class="line">        &lt;/label&gt;</div><div class="line">        &lt;input autocapitalize=&quot;off&quot; autocorrect=&quot;off&quot; autofocus=&quot;autofocus&quot; class=&quot;form-control input-block&quot; id=&quot;login_field&quot; name=&quot;login&quot; tabindex=&quot;1&quot; type=&quot;text&quot; /&gt;</div><div class="line"></div><div class="line">        &lt;label for=&quot;password&quot;&gt;</div><div class="line">          Password &lt;a href=&quot;/password_reset&quot; class=&quot;label-link&quot;&gt;Forgot password?&lt;/a&gt;</div><div class="line">        &lt;/label&gt;</div><div class="line">        &lt;input class=&quot;form-control form-control input-block&quot; id=&quot;password&quot; name=&quot;password&quot; tabindex=&quot;2&quot; type=&quot;password&quot; /&gt;</div><div class="line"></div><div class="line">        &lt;input class=&quot;btn btn-primary btn-block&quot; data-disable-with=&quot;Signing in…&quot; name=&quot;commit&quot; tabindex=&quot;3&quot; type=&quot;submit&quot; value=&quot;Sign in&quot; /&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure></p>
<h3 id="重写start-requests方法"><a href="#重写start-requests方法" class="headerlink" title="重写start_requests方法"></a>重写start_requests方法</h3><p>首先确保 cookie 打开</p>
<pre>COOKIES_ENABLES = True
</pre>

<p>重写start_requests方法</p>
<pre>
# 重写了爬虫类的方法, 实现了自定义请求, 运行成功后会调用callback回调函数
def start_requests(self):
    return [Request("https://github.com/login",
                    meta={'cookiejar': 1}, callback=self.post_login)]

# FormRequeset
def post_login(self, response):
    # 先去拿隐藏的表单参数authenticity_token
    authenticity_token = response.xpath(
        '//input[@name="authenticity_token"]/@value').extract_first()
    logging.info('authenticity_token=' + authenticity_token)
    pass
</pre>

<p>start_requests方法指定了回调函数，用来获取隐藏表单值authenticity_token，同时我们还给Request指定了cookiejar的元数据，用来往回调函数传递cookie标识。</p>
<h3 id="使用FormRequest"><a href="#使用FormRequest" class="headerlink" title="使用FormRequest"></a>使用FormRequest</h3><p>Scrapy为我们准备了FormRequest类专门用来进行Form表单提交的。</p>
<pre>
# FormRequeset
def post_login(self, response):
    # 先去拿隐藏的表单参数authenticity_token
    authenticity_token = response.xpath(
        '//input[@name="authenticity_token"]/@value').extract_first()
    logging.info('authenticity_token=' + authenticity_token)
    # FormRequeset.from_response是Scrapy提供的一个函数, 用于post表单
    # 登陆成功后, 会调用after_login回调函数，如果url跟Request页面的一样就省略掉
    return [FormRequest.from_response(response,
                                      url='https://github.com/session',
                                      meta={'cookiejar': response.meta['cookiejar']},
                                      #headers=self.post_headers,  
                                      formdata={
                                          'login': 'shuang0420',
                                          'password': 'XXXXXXXXXXXXXXXXX',
                                          'authenticity_token': authenticity_token
                                      },
                                      callback=self.after_login,
                                      dont_filter=True
                                      )]
</pre>

<p>FormRequest.from_response()方法让你指定提交的url，请求头还有form表单值，注意我们还通过meta传递了cookie标识。它同样有个回调函数，登录成功后调用。下面我们来实现它。注意这里我继续传递cookiejar，访问初始页面时带上cookie信息。</p>
<pre>
def after_login(self, response):
    # 登录之后，开始进入我要爬取的私信页面
    for url in self.start_urls:
        logging.info('letter url=' + url)
        yield Request(url, meta={'cookiejar': response.meta['cookiejar']},callback=self.parse_page)
</pre>

<h3 id="页面处理"><a href="#页面处理" class="headerlink" title="页面处理"></a>页面处理</h3><p>这个例子的主要任务是模拟登录，在登录 github 后爬取主页的 comments 内容。<br><img src="http://7xu83c.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-05%20%E4%B8%8B%E5%8D%884.19.03.png" alt=""></p>
<p>代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">def parse_page(self, response):</div><div class="line">    &quot;&quot;&quot;comments 内容&quot;&quot;&quot;</div><div class="line">    logging.info(u&apos;--------------消息分割线-----------------&apos;)</div><div class="line">    logging.info(response.url)</div><div class="line">    replaceTags = re.compile(&apos;&lt;.*?&gt;&apos;)</div><div class="line">    replaceLine = re.compile(&apos;\r|\n|\t&apos;)</div><div class="line">    message = response.xpath(</div><div class="line">        &apos;//div[@class=&quot;details&quot;]/div[@class=&quot;message markdown-body&quot;]|div[@class=&quot;message markdown-body&quot;]/blockquote&apos;).extract()</div><div class="line">    for m in message:</div><div class="line">        m = replaceTags.sub(&quot;&quot;, m)</div><div class="line">        m = replaceLine.sub(&quot;&quot;, m)</div><div class="line">        print m</div></pre></td></tr></table></figure></p>
<p>爬取结果</p>
<pre>
I like topn (or perhaps top_n) a little better, because it's not dependent on what the features represent (words, phrases, entities, characters...). …      
Note: as of now, the classes and methods are not well arranged, and there are a few mock classes (which will be removed) to help me with testing. O…      
Hello @gojomo thank you for replying fast.I have used save() to save the model and load_word2vec_format() to load the model. Thats where the probl…      
The unicode_errors='ignore' option should make it impossible for the exact same error to occur; perhaps you're getting some other very-similar error?       
(Nevermind, #758 added annoy.)      
It looks like the tests don't run on Travis, since Annoy is not installed there. Not sure how to fix the test failure in Python 2.6 either.      
Hello,Sorry for posting after even you have created the FAQ.I trained a model with tweets which had some undecodable unicode characters. When i t…      
dtto      
Misleading comment: there is no "training", the model is transferred from Mallet. These parameters only affect inference, model is unchanged.      
PEP8: Hanging indent of 4 spaces.      
@piskvorky I've addressed the comments. Could you please check?      
Thanks, that was quick :)      
@piskvorky , @tmylk , could you review?      
Added comment, made change in changelog.       
No, this was after that in 0.13.2. I noticed it because when I was testing the #768 solution, print_topics was failing.      
@tmylk how do you review these PRs before merging? There are too many errors, we cannot merge code so carelessly.      
Looks good to me... except still needs a comment explaining why the alias is there. And maybe a mention in the changelog, so we can deprecate the o…      
Yes, assign self.wordtopics = self.word_topics, with a big fat comment explaining why this alias is there.      
I don't understand how this version with storing unicode to binary files even worked. It means our unit tests must be faulty / incomplete.     
</pre>

<p><a href="">代码</a></p>
<h2 id="识别验证码"><a href="#识别验证码" class="headerlink" title="识别验证码"></a>识别验证码</h2><p>验证码是一种非常有效的反爬虫机制，它能阻止大部分的暴力抓取，在电商类、投票类以及社交类等网站上应用广泛。如果破解验证码，成为了数据抓取工作者必须要面对的问题。下面介绍3种常用的方法。</p>
<h3 id="更换ip地址"><a href="#更换ip地址" class="headerlink" title="更换ip地址"></a>更换ip地址</h3><p>在访问某些网站时，我们最初只是需要提供用户名密码就可以登陆的，比如说豆瓣网，如果我们要是频繁登陆访问，可能这时网站就会出现一个验证码图片，要求我们输入验证码才能登陆，这样在保证用户方便访问的同时，又防止了机器的恶意频繁访问。对于这种情况，我们可以使用代理服务器访问，只需要换个ip地址再次访问，验证码就不会出现了，当然，当验证码再次出现的时候，我们只能再更换ip地址。</p>
<h3 id="使用cookie登陆"><a href="#使用cookie登陆" class="headerlink" title="使用cookie登陆"></a>使用cookie登陆</h3><p>如果采用cookie登陆，可以这样实现：首先需要手动登陆网站一次，获取服务器返回的cookie，这里就带有了用户的登陆信息，当然也可以采用获取的cookie登陆该网站的其他页面，而不用再次登陆。具体代码已经实现，详见ZhihuSpider。我们只需要在配置文件中提供用户名密码，及相应的cookie即可。对于不出现验证码的情况，爬虫会提交用户名密码实现post请求登陆，如果失败，才会使用事先提供的cookie信息。</p>
<p>需要说明的是，判断爬虫登陆与否，我们只需要看一下爬取的信息里面是否带有用户信息即可。在使用cookie登陆的时候，还需要不定期更新cookie，以保证爬取顺利进行。</p>
<h3 id="验证码识别手段"><a href="#验证码识别手段" class="headerlink" title="验证码识别手段"></a>验证码识别手段</h3><p>使用cookie登陆比较简单，但是有时效性问题。验证码识别是个很好的思路，然而识别的精度又限制了抓取的效率。</p>
<h2 id="爬取js交互式表格数据"><a href="#爬取js交互式表格数据" class="headerlink" title="爬取js交互式表格数据"></a>爬取js交互式表格数据</h2><p>这里，若使用Google Chrome分析”请求“对应的链接(方法：右键→审查元素→Network→清空，点击”加载更多“，出现对应的GET链接寻找Type为text/html的，点击，查看get参数或者复制Request URL)，循环过程。</p>
<h3 id="启动-splash-容器"><a href="#启动-splash-容器" class="headerlink" title="启动 splash 容器"></a>启动 splash 容器</h3><pre>
$ docker run -p 8050:8050 scrapinghub/splash</pre>

<h3 id="配置-scrapy-splash"><a href="#配置-scrapy-splash" class="headerlink" title="配置 scrapy-splash"></a>配置 scrapy-splash</h3><p>在你的 scrapy 工程的配置文件settings.py中添加</p>
<pre>
SPLASH_URL = 'http://192.168.59.103:8050'

# 添加Splash中间件，还是在settings.py中通过DOWNLOADER_MIDDLEWARES指定，并且修改HttpCompressionMiddleware的优先级
DOWNLOADER_MIDDLEWARES = {
    'scrapy_splash.SplashCookiesMiddleware': 723,
    'scrapy_splash.SplashMiddleware': 725,
    'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware': 810,
}

# 默认情况下，HttpProxyMiddleware的优先级是750，要把它放在Splash中间件后面

# 设置Splash自己的去重过滤器
DUPEFILTER_CLASS = 'scrapy_splash.SplashAwareDupeFilter'

# 如果你使用Splash的Http缓存，那么还要指定一个自定义的缓存后台存储介质，scrapy-splash提供了一个scrapy.contrib.httpcache.FilesystemCacheStorage的子类

HTTPCACHE_STORAGE = 'scrapy_splash.SplashAwareFSCacheStorage'

# 如果你要使用其他的缓存存储，那么需要继承这个类并且将所有的scrapy.util.request.request_fingerprint调用替换成scrapy_splash.splash_request_fingerprint
</pre>

<h3 id="使用-scrapy-splash"><a href="#使用-scrapy-splash" class="headerlink" title="使用 scrapy-splash"></a>使用 scrapy-splash</h3><h4 id="SplashRequest"><a href="#SplashRequest" class="headerlink" title="SplashRequest"></a>SplashRequest</h4><p>最简单的渲染请求的方式是使用scrapy_splash.SplashRequest，通常你应该选择使用这个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">yield SplashRequest(url, self.parse_result,</div><div class="line">    args=&#123;</div><div class="line">        # optional; parameters passed to Splash HTTP API</div><div class="line">        &apos;wait&apos;: 0.5,</div><div class="line"></div><div class="line">        # &apos;url&apos; is prefilled from request url</div><div class="line">        # &apos;http_method&apos; is set to &apos;POST&apos; for POST requests</div><div class="line">        # &apos;body&apos; is set to request body for POST requests</div><div class="line">    &#125;,</div><div class="line">    endpoint=&apos;render.json&apos;, # optional; default is render.html</div><div class="line">    splash_url=&apos;&lt;url&gt;&apos;,     # optional; overrides SPLASH_URL</div><div class="line">    slot_policy=scrapy_splash.SlotPolicy.PER_DOMAIN,  # optional</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>另外，你还可以在普通的scrapy请求中传递splash请求meta关键字达到同样的效果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">yield scrapy.Request(url, self.parse_result, meta=&#123;</div><div class="line">    &apos;splash&apos;: &#123;</div><div class="line">        &apos;args&apos;: &#123;</div><div class="line">            # set rendering arguments here</div><div class="line">            &apos;html&apos;: 1,</div><div class="line">            &apos;png&apos;: 1,</div><div class="line"></div><div class="line">            # &apos;url&apos; is prefilled from request url</div><div class="line">            # &apos;http_method&apos; is set to &apos;POST&apos; for POST requests</div><div class="line">            # &apos;body&apos; is set to request body for POST requests</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        # optional parameters</div><div class="line">        &apos;endpoint&apos;: &apos;render.json&apos;,  # optional; default is render.json</div><div class="line">        &apos;splash_url&apos;: &apos;&lt;url&gt;&apos;,      # optional; overrides SPLASH_URL</div><div class="line">        &apos;slot_policy&apos;: scrapy_splash.SlotPolicy.PER_DOMAIN,</div><div class="line">        &apos;splash_headers&apos;: &#123;&#125;,       # optional; a dict with headers sent to Splash</div><div class="line">        &apos;dont_process_response&apos;: True, # optional, default is False</div><div class="line">        &apos;dont_send_headers&apos;: True,  # optional, default is False</div><div class="line">        &apos;magic_response&apos;: False,    # optional, default is True</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>Splash API说明，使用SplashRequest是一个非常便利的工具来填充request.meta[‘splash’]里的数据</p>
<ul>
<li>meta[‘splash’][‘args’] 包含了发往Splash的参数。</li>
<li>meta[‘splash’][‘endpoint’] 指定了Splash所使用的endpoint，默认是render.html</li>
<li>meta[‘splash’][‘splash_url’] 覆盖了settings.py文件中配置的Splash URL</li>
<li>meta[‘splash’][‘splash_headers’] 运行你增加或修改发往Splash服务器的HTTP头部信息，注意这个不是修改发往远程web站点的HTTP头部</li>
<li>meta[‘splash’][‘dont_send_headers’] 如果你不想传递headers给Splash，将它设置成True</li>
<li>meta[‘splash’][‘slot_policy’] 让你自定义Splash请求的同步设置</li>
<li>meta[‘splash’][‘dont_process_response’] 当你设置成True后，SplashMiddleware不会修改默认的scrapy.Response请求。默认是会返回SplashResponse子类响应比如SplashTextResponse</li>
<li>meta[‘splash’][‘magic_response’] 默认为True，Splash会自动设置Response的一些属性，比如response.headers,response.body等<br>如果你想通过Splash来提交Form请求，可以使用scrapy_splash.SplashFormRequest，它跟SplashRequest使用是一样的。</li>
</ul>
<h4 id="Responses"><a href="#Responses" class="headerlink" title="Responses"></a>Responses</h4><p>对于不同的Splash请求，scrapy-splash返回不同的Response子类</p>
<ul>
<li>SplashResponse 二进制响应，比如对/render.png的响应</li>
<li>SplashTextResponse 文本响应，比如对/render.html的响应</li>
<li>SplashJsonResponse JSON响应，比如对/render.json或使用Lua脚本的/execute的响应</li>
</ul>
<p>如果你只想使用标准的Response对象，就设置meta[‘splash’][‘dont_process_response’]=True</p>
<p>所有这些Response会把response.url设置成原始请求URL(也就是你要渲染的页面URL)，而不是Splash endpoint的URL地址。实际地址通过response.real_url得到</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>爬取华为应用市场( <a href="http://appstore.huawei.com/more/all" target="_blank" rel="external">http://appstore.huawei.com/more/all</a> )的“下一页” url 链接。</p>
<h4 id="查看网页源代码"><a href="#查看网页源代码" class="headerlink" title="查看网页源代码"></a>查看网页源代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;http://app.vmall.com/js/core/jquery.min.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    var jsResource = new Array();</div><div class="line">    jsResource[&apos;cloud.page.count&apos;] = &quot;共&quot;;</div><div class="line">    jsResource[&apos;cloud.page.numbers&apos;] = &quot;条记录&quot;;</div><div class="line">    jsResource[&apos;cloud.page.last_page&apos;] = &quot;上一页&quot;;</div><div class="line">    jsResource[&apos;cloud.page.next_page&apos;] = &quot;下一页&quot;;</div><div class="line">    jsResource[&apos;cloud.page.pages&apos;] = &quot;页&quot;;</div><div class="line">    jsResource[&apos;cloud.page.first&apos;] = &quot;首页&quot;;</div><div class="line">    jsResource[&apos;cloud.page.last&apos;] = &quot;尾页&quot;;</div><div class="line">    jsResource[&apos;cloud.downAppError&apos;]=&quot;您的请求正在处理中，请不要重复提交。&quot;</div><div class="line">    jsResource[&apos;cloud.msg.ok&apos;]=&quot;确定&quot;</div><div class="line">    jsResource[&apos;cloud.msg.message&apos;]=&quot;提示&quot;</div><div class="line">    jsResource[&apos;cloud.detail.close&apos;]=&quot;关闭&quot;</div><div class="line">&lt;/script&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;http://app.vmall.com/js/all/more.js?version=2.9.5.20150418&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure>
<h4 id="查看渲染后的代码"><a href="#查看渲染后的代码" class="headerlink" title="查看渲染后的代码"></a>查看渲染后的代码</h4><p>启动 splash 容器，在浏览器打开 <a href="http://192.168.59.103:8050/" target="_blank" rel="external">http://192.168.59.103:8050/</a> ， 输入网址进行 render，查看渲染后的代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;page-ctrl ctrl-app&quot; id=&quot;recommendListPage&quot;&gt;&lt;a href=&quot;http://appstore.huawei.com:80/more/all/1&quot;&gt;首页&lt;/a&gt; &lt;a href=&quot;http://appstore.huawei.com:80/more/all/1&quot;&gt;&lt;em class=&quot;arrow-grey-lt&quot;&gt;&amp;nbsp;&lt;/em&gt;上一页&lt;/a&gt; &lt;a href=&quot;http://appstore.huawei.com:80/more/all/1&quot;&gt;1&lt;/a&gt;&lt;span&gt;2&lt;/span&gt; &lt;a href=&quot;http://appstore.huawei.com:80/more/all/3&quot;&gt;3&lt;/a&gt; &lt;a href=&quot;http://appstore.huawei.com:80/more/all/4&quot;&gt;4&lt;/a&gt; &lt;a href=&quot;http://appstore.huawei.com:80/more/all/5&quot;&gt;5&lt;/a&gt; &lt;a href=&quot;http://appstore.huawei.com:80/more/all/3&quot;&gt;下一页&lt;em class=&quot;arrow-grey-rt&quot;&gt;&amp;nbsp;&lt;/em&gt;&lt;/a&gt; &lt;a href=&quot;http://appstore.huawei.com:80/more/all/41&quot;&gt;尾页&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<h3 id="spider-部分代码"><a href="#spider-部分代码" class="headerlink" title="spider 部分代码"></a>spider 部分代码</h3><pre>
def parse(self, response):
    page = Selector(response)
    hrefs = page.xpath('//h4[@class="title"]/a/@href')
    if not hrefs:
        return
    for href in hrefs:
        url = href.extract()
        yield scrapy.Request(url, callback=self.parse_item)
# find next page
    nextpage = page.xpath('//div[@class="page-ctrl ctrl-app"]/a/em[@class="arrow-grey-rt"]/../@href').extract_first()
    print nextpage
    yield scrapy.Request(nextpage,callback=self.parse,meta={
    'splash': {
    'endpoint': 'render.html',
    'args': {'wait': 0.5}
    }
    })
</pre>

<p><a href="">完整代码</a></p>
<h2 id="分析不规则的-html"><a href="#分析不规则的-html" class="headerlink" title="分析不规则的 html"></a>分析不规则的 html</h2><p>之前的几个部分解决的都是 下载 Web 页面 的问题，这里补充下获取网页后分析过程的一些技巧。<br>以苏宁易购 help 页面为例。start_url 是 <a href="http://help.suning.com/faq/list.htm" target="_blank" rel="external">http://help.suning.com/faq/list.htm</a> ， 爬取的是左边侧栏每个大类的每个小类下右边的问题页面，如“权益介绍”、“等级权益介绍”这些 FAQ 页面，如何到达这些页面就不再多说，关键是到达这些页面后怎么获得信息。<br><img src="http://7xu83c.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-04%20%E4%B8%8B%E5%8D%883.37.07.png" alt=""></p>
<p>看一部分的网页源代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;contentShow&quot;&gt;</div><div class="line">						 	&lt;p class=&quot;MsoNormal&quot; style=&quot;background:white;text-align:left;&quot; align=&quot;left&quot;&gt;</div><div class="line">	&lt;span style=&quot;font-size:9pt;font-family:宋体;color:black;&quot;&gt;&lt;/span&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;p class=&quot;MsoNormal&quot; style=&quot;background:white;&quot; align=&quot;left&quot;&gt;</div><div class="line">	&lt;br /&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;p class=&quot;MsoNormal&quot; style=&quot;background:white;&quot; align=&quot;left&quot;&gt;</div><div class="line">	&lt;b&gt;一、权益类型&lt;/b&gt;&lt;b&gt;&lt;/b&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;p class=&quot;MsoNormal&quot; style=&quot;background:white;&quot; align=&quot;left&quot;&gt;</div><div class="line">	本次改版将上线&lt;span&gt;7&lt;/span&gt;个会员权益，涵盖价格优惠、资格抢先、服务优先等多个方面，会员等级越高，可享受到的会员权益越多。&lt;span&gt;&lt;/span&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;p class=&quot;MsoNormal&quot; style=&quot;background:white;&quot; align=&quot;left&quot;&gt;</div><div class="line">	&lt;b&gt;二、具体详情：&lt;/b&gt;&lt;b&gt;&lt;/b&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;p class=&quot;MsoNormal&quot; style=&quot;background:white;&quot; align=&quot;left&quot;&gt;</div><div class="line">	&lt;b&gt;1&lt;/b&gt;&lt;b&gt;、生日红包&lt;/b&gt;&lt;br /&gt;</div><div class="line">特权内容：&lt;span&gt;&lt;br /&gt;</div><div class="line">&lt;/span&gt;已验证手机号的&lt;span&gt;V2&lt;/span&gt;及以上等级的会员，在实名认证或完善生日资料后，可在生日周期间获得生日红包。&lt;span&gt;&lt;br /&gt;</div><div class="line">&lt;/span&gt;&lt;span&gt;V2&lt;/span&gt;等级生日红包为&lt;span&gt;6&lt;/span&gt;元云券，&lt;span&gt;V3&lt;/span&gt;等级生日红包为&lt;span&gt;8&lt;/span&gt;元云券。（&lt;span&gt;2016&lt;/span&gt;年6月12日开始实施）&lt;span&gt;&lt;br /&gt;</div><div class="line">&lt;/span&gt;注意事项：&lt;span&gt;&lt;br /&gt;</div><div class="line">1&lt;/span&gt;）生日红包券为限品类云券，在生日周时自动发到会员账户，会员在成功收到生日红包券后会有短信提醒，并可登录“我的易购&lt;span&gt;-&lt;/span&gt;我的优惠券”【&lt;span&gt;&lt;a href=&quot;http://member.suning.com/emall/MyGiftTicket&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;点击查看&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;】，每个会员同一自然年内仅可获得一张生日红包券；&lt;span&gt;&lt;br /&gt;</div><div class="line">2&lt;/span&gt;）券使用规则：且限一次性使用、不找零、不兑现，不可以和云券叠加，可以和无敌券、易券叠加使用，不可使用自提；&lt;span&gt;&lt;br /&gt;</div><div class="line">3&lt;/span&gt;）券有效期：自券到账之日起&lt;span&gt;8&lt;/span&gt;日内有效；&lt;span&gt;&lt;br /&gt;</div><div class="line">4&lt;/span&gt;）券适用商品范围：仅限购买自营商品使用，也可以用于大聚惠、抢团购、手机专享价、名品特卖商品，但闪拍、秒杀、预售、海外购、虚拟商品、特殊类商品（一段奶粉等）及平台商户商品不可使用；&lt;span&gt;&lt;br /&gt;</div><div class="line">5&lt;/span&gt;）使用生日红包券的订单若发生退货，在有效期内券将返回至顾客账户，可再次使用；如用券订单退货时已超过券有效期，券将自动失效，不做延期；&lt;span&gt;&lt;/span&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">......</div></pre></td></tr></table></figure></p>
<p>不难发现，有些文字分布在</p>
<ul>
<li>div[@id=”contentShow”]/p</li>
<li>div[@id=”contentShow”]/p/span</li>
<li>div[@id=”contentShow”]/p/b</li>
</ul>
<p>观察其他页面会发现还有些分布在 div[@id=”contentShow”]/h4 下或者 h3 下，有的甚至直接就在 div[@id=”contentShow”] 下。。<br>怎么办？<br>当然可以穷尽各种规则，也可以先把不需要的标签给去掉再 extract，这些我开始都傻傻的尝试过，结果总会忽略一些文字，后来在沮丧的看着 output 文件时福至心灵，直接取了 div[@id=”contentShow”] 再把所有的标签去掉不就行了？！</p>
<p>上代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">page = html.xpath(&apos;//div[@id=&quot;contentShow&quot;]&apos;).extract_first()</div><div class="line">replaceTags = re.compile(&apos;&lt;.*?&gt;&apos;)</div><div class="line">replaceLine = re.compile(&apos;\r|\n|\t&apos;)</div><div class="line">page = replaceTags.sub(&quot;&quot;, page)</div><div class="line">page = re.sub(replaceLine, &quot;&quot;, page)</div></pre></td></tr></table></figure></p>
<p>最后的结果非常干净<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&quot;url&quot;: &quot;http://help.suning.com/page/id-26.htm&quot;, &quot;text&quot;: &quot; 一、账号注册目前注册个人用户仅支持：手机号方式进行注册。1、打开苏宁易购网站，点击页头“注册”，进入注册页面 2、进入注册页面，如果您是个人用户，可以用手机号进行注册；如果您是企业用户，可以点击“企业用户注册”，用单位名称进行注册，如果您有易购账号，可以点击“马上登录”3、填写注册信息，按照网页提示，填写手机号、验证码和密码 4、恭喜您，注册成功 &quot;, &quot;question&quot;: &quot;账户注册&quot;, &quot;title&quot;: &quot;易购注册登录&quot;&#125;</div></pre></td></tr></table></figure></p>
<p>掌握这个技巧，处理类似问题就很简单啦，如再爬京东的 help 网页，稍微改下代码5分钟就能搞定。</p>
<p><a href="">代码</a></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>回头谈点背景知识,scrapy使用了twisted.一个异步网络框架.因此要留意潜在的阻塞情况.但注意到settings中有个参数是设置ItemPipeline的并行度.由此推测pipeline不会阻塞,pipeline可能是在线程池中执行的(未验证).Pipeline一般用于将抓取到的信息保存(写数据库,写文件),因此这里你就不用担心耗时操作会阻塞整个框架了,也就不用在Pipeline中将这个写操作实现为异步.<br>除此之外框架的其他部分.都是异步的,简单说来就是,爬虫生成的请求交由调度器去下载,然后爬虫继续执行.调度器完成下载后会将响应交由爬虫解析.<br>网上找到的参考例子,部分将js支持写到了DownloaderMiddleware中,scrapy官网的code snippet也是这样 .若这样实现,就阻塞了整个框架,爬虫的工作模式变成了,下载-解析-下载-解析,而不在是并行的下载.在对效率要求不高的小规模爬取中问题不大.<br>更好的做法是将js支持写到scrapy的downloader里.网上有一个这样的实现(使用selenium+phantomjs).不过仅支持get请求.<br>在适配一个webkit给scrapy的downloader时,有各种细节需要处理.</p>
<blockquote>
<p>参考链接<br><br><a href="http://www.pythontab.com/html/2014/pythonweb_0311/712.html" target="_blank" rel="external">scrapy定制爬虫-爬取javascript内容</a><br><br><a href="http://www.pycoding.com/2016/04/12/scrapy-11.html" target="_blank" rel="external">Scrapy笔记（11）- 模拟登录</a><br><br><a href="http://www.lining0806.com/6-%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB-%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E9%99%86/" target="_blank" rel="external">网络爬虫-验证码登陆</a><br><br><a href="http://www.pycoding.com/2016/04/15/scrapy-12.html" target="_blank" rel="external">Scrapy笔记（12）- 抓取动态网站</a></p>
</blockquote>

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat.jpg" alt="徐阿衡 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎关注：徐阿衡的微信公众号</div>
</div>


      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>客官，打个赏呗~</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://7xu83c.com1.z0.glb.clouddn.com/1.pic.jpg" alt="徐阿衡 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Crawler/" rel="tag">#Crawler</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/17/爬虫总结-四-分布式爬虫/" rel="next" title="爬虫总结(四)-- 分布式爬虫">
                <i class="fa fa-chevron-left"></i> 爬虫总结(四)-- 分布式爬虫
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/20/TensorFlow实战-MNIST/" rel="prev" title="TensorFlow 实战 MINST">
                TensorFlow 实战 MINST <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      



    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
     
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xu83c.com1.z0.glb.clouddn.com/2.pic.jpg"
               alt="徐阿衡" />
          <p class="site-author-name" itemprop="name">徐阿衡</p>
          <p class="site-description motion-element" itemprop="description">读万卷书，行万里路 @SYSU @CMU</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">163</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">125</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Shuang0420" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.linkedin.com/in/shuang-xu-7008b894?trk=nav_responsive_tab_profile_pic" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  LinkedIn
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://zhuanlan.zhihu.com/c_136690664" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://starllap.space" title="Star" target="_blank">Star</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://liam0205.me" title="Liam Huang" target="_blank">Liam Huang</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.libinx.com" title="Li Bin" target="_blank">Li Bin</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#模拟登录"><span class="nav-number">1.</span> <span class="nav-text">模拟登录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#研究源码"><span class="nav-number">1.1.</span> <span class="nav-text">研究源码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重写start-requests方法"><span class="nav-number">1.2.</span> <span class="nav-text">重写start_requests方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用FormRequest"><span class="nav-number">1.3.</span> <span class="nav-text">使用FormRequest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面处理"><span class="nav-number">1.4.</span> <span class="nav-text">页面处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#识别验证码"><span class="nav-number">2.</span> <span class="nav-text">识别验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#更换ip地址"><span class="nav-number">2.1.</span> <span class="nav-text">更换ip地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用cookie登陆"><span class="nav-number">2.2.</span> <span class="nav-text">使用cookie登陆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证码识别手段"><span class="nav-number">2.3.</span> <span class="nav-text">验证码识别手段</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#爬取js交互式表格数据"><span class="nav-number">3.</span> <span class="nav-text">爬取js交互式表格数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#启动-splash-容器"><span class="nav-number">3.1.</span> <span class="nav-text">启动 splash 容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-scrapy-splash"><span class="nav-number">3.2.</span> <span class="nav-text">配置 scrapy-splash</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-scrapy-splash"><span class="nav-number">3.3.</span> <span class="nav-text">使用 scrapy-splash</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SplashRequest"><span class="nav-number">3.3.1.</span> <span class="nav-text">SplashRequest</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Responses"><span class="nav-number">3.3.2.</span> <span class="nav-text">Responses</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实例"><span class="nav-number">3.4.</span> <span class="nav-text">实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#查看网页源代码"><span class="nav-number">3.4.1.</span> <span class="nav-text">查看网页源代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看渲染后的代码"><span class="nav-number">3.4.2.</span> <span class="nav-text">查看渲染后的代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spider-部分代码"><span class="nav-number">3.5.</span> <span class="nav-text">spider 部分代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分析不规则的-html"><span class="nav-number">4.</span> <span class="nav-text">分析不规则的 html</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">5.</span> <span class="nav-text">其他</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <!-- Other code may be here -->
<div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">徐阿衡</span>
  <a href="http://www.miitbeian.gov.cn/">粤ICP备17129486号</a>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>


<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'httpshuang0420githubio';
      var disqus_identifier = '2016/06/20/爬虫总结-五-其他技巧/';
      var disqus_title = "爬虫总结(五)-- 其他技巧";
      var disqus_url = 'http://www.shuang0420.com/2016/06/20/爬虫总结-五-其他技巧/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


</body>
</html>
